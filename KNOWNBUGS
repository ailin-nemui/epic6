EPIC6 Projects, Bugs, and other Errata:

The philosophy of EPIC6 is to make the UX better.  
Many things have UX that is obtuse and so people don't use features.
Although things may disappear in the near term, they will be
reimagined and brought back in a better form later.

"Make the complicated simple
 Reduce Clutter
 Focus on what people actually want to do"

Things to remove
=================
*our glob (globi) - Not sure if appropriate
*pthreads, etc	  - Just use poll
*our SHA2	  - We can get this from openssl
our sdbm (dbmctl) - Use a modern key-value store (sqlite)
*ruby		  - Incomplete/unloved
*perl		  - Incomplete/unloved
*All encryption but AES - Obsolete/insecure

Things to remove, but bring back
================================
e2e encryption	  - Targeting
ignore		  - Targeting
flood control	  - Incomplete/unloved
*mail checking    - Scriptable (brought back)
*notify	  	  - Scriptable/unloved (brought back)
DCC		  - Or at least direct sockets

Things to support
=================
*CAP/*SASL
*Unlimited input line
*Mouse support
*PBKDF
*Auto-ssl for ssl ports
*tcgetwinsize() instead of ioctl()
*c-ares
*Base85
libsodium
sqlite
*Targeting
ZNC
Emojis (incl ZWJ)
Arena allocation
PCRE2 (utf8-aware regex)

Actual bugs
================
* /SET NEW_SERVER_LASTLOG_LEVEL does not work properly because it doesn't check window servers.
* Create /load ignore on top of /on context and /shh

THE CHANGELOG SINCE THE LAST RELEASE:
-------------------------------------
* Sunset most of docs/ and other ancient files
* Sunset /queue (and queue.c)
* Sunset $globi() (and glob.c)
* Sunset support for pre-wiki help files in script/
* Sunset I/O disciplines other than select()
* This means we can sunset ./configure --with-multiplex
* This means we can sunset pthreads
* This means we can sunset pthreads-with-openssl locking
* Reset $info(o), since most flags are mandatory (see UPDATES)
* Sunset all compat stuff
* This means we don't care about reapath, tparm, strlc*, etc
* Use OpenSSL to do SHA256 hashing. (digest, digest_hexstr)
* Sunset our custom sha2 implementation
* Sunset our custom alloca implementation
* Sunset ara, the feature that never was
* (<- 2141) Add circuit breaker if recalculate_windows gets jammed
* (<- 2141) Fix two memory leaks; one major, one minor
* (<- 2142) Fix more memory leaks 
* Begin a project to review and revise comments all over the code base.
* Particularly, things that come across as insulting/unkind are rewritten.
* Sunset IRCII_LIKE_BAN_SUMMARY
* Sunset our custom glob()
* Adopt a new IRCII_COMMENT for epic6 (yay!)
* Sunset FiSH support
* Sunset SED, SEDSHA, CAST5, BLOWFISH e2e support
* Sunset "external encryption" e2e support
* Sunset being able to specify what kind of e2e encryption to use
* Sunset our quirky random number generators; use OpenSSL always.
* Sunset $crypt() and $encryptparm().
* Consolidate "hidden" and "invisible" to just "invisible"
* Add /window kill_all_invisible
* Add $pbkdf2(), Improve your passwords
* Check for, link to sqlite at build time (stay tuned!)
* (-> 2145) Support backrefs with extended regex for BSD, Mac OS (sigh)
* Various reformattings in header files
* Sunset all spurious #define's in config.h
* Sweep config.h and remove all #define's that don't exist
* Sunset option flag b (bots) and t (i don't trust)
* Sunset CPU Saver mode because it's not 1994 any more
* Sunset the "old math parser" and /xdebug old_math_parser
* GC old code that converted wildcard patterns to regexes
* (<- 2146, 2147) script fixes from zlonix, skered
* (<- 2144) fix openssl evp padding
* (<- 2148) GLOB_QUOTE is not a thing that exists.
* (<- 2149) Change notion of "away" to "away_message" 
* (<- 2149) Add notion of "away status" and $serverctl(GET x AWAY_STATUS)
* (<- 2150) Add /exec -exit {} (rb fusion)
* (<- 2151,2152) UX improvements to ssl server connections
* Sunset /on encrypted_(privmsg|notice)
* Rename 'sed_type' to 'cipher_type'
* GC any remaining code pertaining to sunset encryption types
* Implement $token() for fusion
* Sunset mail checking, /set mail* and everything else,
* Sunset /notify, $D, and everything else,  
* Sunset #include <sys/ioctl.h>, we don't use ioctl!
* Sunset e2e encryption (/crypt) for now.  
* Sunset openssl evp encryption ($xform(AES256)) for now.
* Sunset /ignore, $ignorectl() and everything else, 
* Sunset /dcc, $dccctl() and everything else  
* Don't use GLOB_BRACE, it's nonstadnard (rb Kitambi)
* Sunset ruby support,  RIP - 2006-2025
* Sunset perl support.  RIP - 2001-2025
* Clean up configure.ac -- remove things we don't support any more
* Also, remove things we don't tolerate being absent any more
* Refactor expand_twiddle() to use getpwnam_r()
* Sunset the commented out SHIFT-JIS stuff
* At this point, terminfo support is mandatory. Come on -- it's 2025.
* Permit ^X RGB codes (ONLY (for now)!) to be surrounded by {}s
  - eg, ^X{#aabbcc,ddeeff}
* Change $rgb() to use the new syntax.
* Sunset ability to run epic as a shell script (ie, #!/usr/local/bin/epic -S)
* Sunset some /set's that setted sunsetted features.
* Sunset default values for /sets that are removed
* Send every message one at a time (no bunching)
* Chonk messages sent to irc approximately every 480 bytes
* Input line is now unlimited (it auto-expands as you type)
* Apparently linux doesn't have tcgetwinsize() [Sigh] (rb fusion)
* More fixes for linux not having tcgetwinsize() (rb fusion)
* Sunset the QUIT_IRC keybinding
* Implement multiple keymap sets
* Add /bind <X> KEYMAP <keymap>  -- for now, only HEAD and MOUSE work.
* Add /set mouse, turn on mouse click to focus and scrollwheel.
* Create an "on exit" internal api to shadow /on exit
* Register an "on exit" callback to turn off mouse mode
* (<- 2156) Fix/rewrite $uname() [rb sob]
* Check for/use libsodium in configure.
* Add the overlooked $serverctl(GET|SET <ref> SERVER_STATUS) (rb fusion)
* Remove all remaining references to DCC whatsoever
* Fix things called out by clang and gcc static analyzers.
* Sunset /redirect and /flush
* Add a new /pyload newmail   mail checker.
* Add back /set status_mail and %M for now.
* Improve newmail by modularizing the mail checker so it can be extended
* Also, create a consolidated mail checker to add mbox + Maildir together.
* So now /set mail_status_format can support {cur} and {new} counts 
* For now, always show the python stack trace to help me debug.
* Add /load notify, to implement /notify on top of MONITOR
* Now /load notify and /load mail are loaded in 'builtins'
* Fix bogon in mail.py (rb wcarson)
* Fix another bogon for mails w/o message-id's [bah!]
* Add is_word_in_wordlist() for "in" and "not in" operators
* Add "in" and "not in" operators -- ie, if ([x] in var) {...}
* Adjust some of the sasl scripts to use it instead of expando ons
* Revert the changes I just made to the sasl scripts
* Complete refactor of cJSON.c, updated to latest upstream commit
* Add /slurp_file and /filter file to /load files
* Create /load json, to work with json files
* Split connect_to_server() out into  bootstrap_server_connection()
* This allows support for the "POLICY" server state (see UPDATES)
*  This will be used for CAP/SASL soon enough...
* Change callbacks to add_wait_prompt() to take two (const char *s)
* Change the default for $json_implode() to "compact"
* Switch from select() to poll() for multiplexing.
* Remove the rest of the remnants of select() and friends.
* Add compat strlcpy()/strlcat() for legacy glibc
* Remove remaining uses of strcpy/strcat/sprintf() in cJSON.c
* Don't use INFTIM, that's a bsd-ism. -1 is fine for poll().
* Various and Sundry Changes suggested by static analyzers.
* Stop checking for standard things in 'configure.ac'.
* More removals from configure.ac.
* Even more removals for historical unix behaviors!
* First round of c-ares support, $iptoname(), $nametoip()
* Apparently linux needs <sys/ioctl.h> to define 'struct winsize'
* Nearly complete refactor of network.c, all things sockets and dns
* Stop using getaddrinfo() and friends except for non-dns things
* Sunset support for unix domain sockets (for /server)
* Retrench on using poll(2) for everything; refactor newio to pass 'revent'
* You now tell new_open() what poll(2) flags you are interested in.
* The new c-ares stuff is built on the refactored newio stuff
* Rename inet_* functions to avoid obsolete jargon abbreviations 
* $iptolong() is reverted to using inet_aton().
* $longtoip() is reverted to using inet_ntoa().
* The ^S keybinding to TOGGLE_STOP_SCREEN is no longer a default
* Refactor how vhosts are handled, with caching.
* Unfortunately, vhost handling is still blocking.
* Don't bother to figure out what hosename or modes to send at USER time
* <- (2158) Better handle IRC/IRC-SSL when servers don't respond
* Use getifaddrs() to pull our local ips at start-up.
* Add undocumented /vhosts command -- it's just for debugging for now.
* Use -Wshadow and -Wpedantic if they're available
  - Fix all warnings thereupon
* Restart refactoring global variables
* Don't require a valid hostname upon startup (we use vhosts above)
* Remove the 'now' variable -- just check the time when you need it.
* Deprecate all (Timeval), move to (Timespec) 
* Create_new_screen() now is told if this is 1st or 2nd screen
* Switch \e to \x1B in literal strings (\e is non-standard)
* Roll /hostname in with vhost support so we track "default" vhost
* Fix bug in kreadable() that broke /window create
* Refactor /window create to avoid a "resource leak" clang insists upon
* Deprecate /WHO queue debugging.
* Switch /server dns lookup from dns helper to c-ares. Yay! \o/
* This includes some vibe code from gemini which I did as an experiment.
* This uncovered some weaknesses in how poll() errors are handled. ummm...
* There are a lot more debug info for the moment.
* Make socklen() a global function
* Removal of #if 0'd out code.
* Fix <xlocale.h> and <ioctl.h> madness for mac os x.
* Remove the rest of the who queue debugging.
* Add configure check for xlocale.h (rb fro)
* Add a handler for dns failure (rb fro)
* Sunset the now unused async dns helper. yay!
* Sunset the now unused old vhost handler. yay!
* Getaddrinfo() now stops you from using it in a blocking way
* Getnameinfo() now stops you from using it in a blocking way
* Add ecdsatool.c, which facilitates SASL key sign-ins
* This includes $ecdsatool() [see UPDATES]
* Further refinements to the chatty-ness of the nonblocking dns stuff
* Add /xdebug newio to hide a lot of newio chatter
* Add /on authenticate, and /on cap -- more on this later
* Sort of adapt the 'capctl' and 'sasl_auth' scripts to use them.
* The other sasl scripts are still TBD (and now broken)
* Why, in the name of anything, was i watching /exec stderr with POLLOUT?
* ZNC does not send "*" as the placeholder nick during CAP negotiation
* Refine scripts/capctl to match on both ourname and itsname
* Fix bad type in param for check_permissions (rb fro)
* Change $glob() to return empty on zero matches, for backwards compat
  - POSIX requires glob(3) to return -3 on zero matches these days...
* Add some more debugging diagnostics for p_cap
* Put queue.c and queue.h back for fudd. :) 
* Add ssuport() and setssuport() to get ports in and out of SSus'
* Hide much of the chattyness for dns, vhost, behind /xdebug server_connect
* Refine /on cap -- $0 = from, $1 = LS, $2 = key, $3- = value
* Introduce the idea of "cap hold" -- so CAP END doesn't get sent too early.
$ Add $serverctl(GET|SET x CAP_HOLD y)
* Add $serverctl(SET x PORT y) that actually works correctly.
* Once again try to ensure the port and the type (IRC/IRC-SSL) are reasonable
* Set the port in a sockaddr from the server desc before we use it.
* Add $serverctl(SET x CERT y)
* Add /load sasl - unified sasl handling (tested on libera)
* Fix a typo in /load sas (rb zlonix)
* Refactor irc_std.h.  All #include <x.h>'s now must be there.
* Reduce some chattiness of debugging info now that things are solidifying up.
* Add /ON CONTEXT and /SHH (see UPDATES)
* Add /SHH which suppresses output for the current context
* Add coalesce() to reduce dependency on ?: operator
* Make paddr_to_ssu() external so it can be used by $iptolong()
* This allows us to retire the final inet_aton() and inet_ntoa(). yay!
* Sunset the "what's our userhost?" feature, which was used for DCC
* Refactor message_from() to set_context().
* /load sasl now supports SCRAM-SHA-512 (see UPDATES)
* Add scrambox.c, all the gory C stuff for scram handling
* Add /xdebug scram for my own edification
* Add $scrambox() for the sasl support
* Fix /load sasl to match sasl rules with server support [see UPDATES]
* Provide decls for strlcpy()/strlcat() if needed (rb fudd)
* Fix some compiler warnings. (rb fro)
* Base85 string transformation (see UPDATES)
* Introduce internal "coalesce()" function: coalesce(x,y) is like x ?? y
* Convert is_string_empty() users to empty().
* Allow base85 internally; switch $regcomp() et al to use base85.
* Add coments, move functions, refactors in ircaux.c
* Refactor base85 converter to use pure math and no bit extracts
* Sunset the "hold/unhold" stuff in newio.  I feel a refactor coming on!
* Add comments, move functions, refactors in parse.c
* Reorganize/refactor newio.c.  Fixed a bug rb wcarson along the way!
* Fix off-by-one error (rb fro)
* Remove -Wno-unused-parameter and -Wno-unused-function warnings
* Mostly, this entails adding __attribute__((unused)) to a lot of things.
* Although I did find a few problems here and there.
* Add (vibe) code to parse out the server descriptions, WIP for now.
* Convert A005 data structure to "OPTION" data, shoehorn 005s into it.
* This will lead to storing CAPs in there eventually
* Start fussing around with ServerInfo data structure...
* Fix bugs found by clang static analyzer.
* Fix /whois without arg (rb wcarson, fudd)
* Add $serverctl(RESET <x>) for znc resets (for wcarson)
* Fix $winchan() when chanwin is -1 (rb roar)
* Replace vibe code for kwarg handling with code that actually works
* Sunset the legacy ircII regex matcher.
* Sunset /xdebug regex and /xdebug no_color.  
* Add /xdebug kwarg_parse and /xdebug rfc1459
* Add coalesce_empty() to get a non-"empty" string
* Add "kwarg_string_to_json()" -- server descriptions to json
* Add debug() which replaces if (x_debug & XXX) yell(...)
* Put a cJSON "root" item in the ServerInfo.
* Migrate all debug output to use debug()
* Actually fix /whois this time
* Explicitly handle 'localhost' special, to work around c-ares weirdness 
* Begin major refactor of "ServerInfo" data structure.
* We are moving away from a C struct to a cJSON Object.  One step at a time.
* Finalize the API to get ServerInfo values, and constrain ServerInfo use
* Start storing the ServerInfo in the json object as well as the struct
* Sunset check for sa_len - we don't work on raw sa's any more.
* Sunset check for UDS support in getaddrinfo - we don't do that any more.
* Sunset historical weirdness for alloca().  It's not 1992 any more.
* Add support for pcre2 -- use it if you got it!
* Several adaptations of the json support
  - Collapse "True/False" types to "Bool" with a valuebool.
  - Regorg the header file, remove stuff we don't use
  - Introduce the notion of "casting" by allowing a value to be represented
    in different types (ie, string to bool, or to number)  Perhaps I will 
    regret this someday...
  - Support resetting a scalar item's type and value, which i already regret,
    but I need to be able to use these as variables.  You can't reset an 
    array or object.
* Don't make /load loadformats look at $info(o), that's unnecessary
* Sunset worrying if non-standard SA_INTERRUPT exists.
* Sunset code behind #define's we've removed already
* Fix runaway loop
* Begin the refactoring of server project...
* Allow cJSON values to be coalesced and unconditionally reset by type 
* Rename cJSON_ArrayForEach -> ForEach since it can be used on objects as well
* Change WAIT_PROMPT_DUMMY to WAIT_PROMPT_NOOP for kindness sake
* Create formal abstraction layers for serverdesc, server info, server, 
  and server list, and create APIs for each layer
* ServerInfos no longer contain a rigid compiled-in schema, they're just 
  a cJSON object with whatever fields you want.
* Getting a value from a serverinfo now requires getters and setters
* Function names get changed so they're always like serverlist_<whatever>
* Remove the "funny stuff" handling for /names and /list
* Refactor /pause to not use static global variables
* Fix so many compiler warnings at -O2 and without it
* Try to make /bind DELETE_TO_PREVIOUS_SPACE behave like epic4 did.
* Fix bogon (rb fusion)
* SI's must be deep copied (with cJSON_Duplicate()) (rb fusion)
* When normalizing levels, use commas instead of spaces (see UPDATES)
* Call @scrambox(RESET) more often.  Fixes sasl scram on reconnects.
