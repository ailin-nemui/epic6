# IRC II was originally written by Michael Sandrof
# Copyright 1991 Michael Sandrof
# Copyright 1993 Matthew Green
# Copyright 1998 EPIC Software Labs
#
# This software uses your normal, default targets.  It should not be any
# more difficult than anything else to install.
#
# Most useful targets:
#	make		- Compiles ircII and wserv4
#	make install	- Installs ircII and wserv4 and the standard script
#			  library to the normal places
#	make clean	- Remove everything created by compiling
#	make distclean	- make clean + remove autoconf generated stuff
#
# Other interesting targets:
#	make wserv		- Compile just wserv
#	make installwserv 	- Installs just wserv
#	make installepic	- Installs just the epic binary
#	make installscript 	- Installs just the standard script library
#
# @configure_input@

CC = @CC@
DEFS = @DEFS@
LIBS = @LIBS@

# Compiler/Linker flags -- These flags are passed to both the compiler
#			   and the linker.  Common flags include:
# -g 		Include debugging info in the binary.  
# -O		Compiler should do some basic optimizations.  
# -Wall 	For GCC compilers, the -Wall flag turns on lots of additional
#		warning checks.  You can safely ignore any warnings about 
#		"NULL format", as those uses are intentional.
CFLAGS = @CFLAGS@

# Linker flags -- These flags are passed only to the linker.
#		  Common flags include:
# -s		Strip all debugging information from the resulting binary. 
# -static	Generate a binary that does not use shared libraries
LDFLAGS = @LDFLAGS@


#
# These are automatically generated by 'configure'.  You really ought to 
# get in the habit of specifying these to 'configure' rather than changing 
# them here. ;-)
#
# Note that some things have changed!  This summarizes the changes:
#
# Script library	old:	/usr/local/lib/irc/script	
#			new:    /usr/local/share/epic6/script
# Help files		old:	/usr/local/lib/irc/help
#			new:    /usr/local/share/epic6/help
# Wserv location	old:	/usr/local/bin/wserv
#			new:	/usr/local/libexec/wserv
#
IP	    = @program_prefix@
prefix      = @prefix@
exec_prefix = @exec_prefix@
bindir      = @bindir@
libexecdir  = @libexecdir@
datarootdir = @datarootdir@
mandir	    = @mandir@

epic6       = @epic6@
epic6_exe   = $(bindir)/$(epic6)
wserv_exe   = $(libexecdir)/$(epic6)-wserv4
epic6dir    = $(datarootdir)/$(epic6)

############ You ought not change anything below this line ###################

RM = rm -f
CP = cp
MV = mv
INSTALL_PROGRAM = install -p -m 755
INSTALL_DATA = install -p -m 644

VERSION  = @VERSION@

SHELL = /bin/sh
MAKE2 = $(MAKE) $(MFLAGS)
MFLAGS ='CC=$(CC)'					\
	'CFLAGS=$(CFLAGS)'				\
	'DEFS=$(DEFS)'					\
	'INSTALL_WSERV=$(wserv_exe)'			\
	'IRCLIB=$(epic6dir)'				\
	'LDFLAGS=$(LDFLAGS)'				\
	'LIBS=$(LIBS)'					\
	'RM=$(RM)'

# To support parallel make, only recur to subdirectory once
# instead of once for epic6 and once for wserv4.
all everything:
	@+cd source; $(MAKE2) epic6 @WSERV_BIN@
install installeverything: all installbin installscript installman
installbin: installepic6-@INSTALL_TYPE@ @WSERV_INSTALL@

uninstall uninstalleverything: uninstallbin uninstallscript uninstallman uninstalldirs
uninstallbin: uninstallepic6-@INSTALL_TYPE@ uninstallwserv4 uninstalloldbins

VPATH=@srcdir@

#
# Main irc binary
#
epic6:
	@+cd source; $(MAKE2) all
installepic6 installirc: installepic6-@INSTALL_TYPE@

EPIC 	  = $(epic6_exe)-$(VERSION)
EPIC_OLD  = $(epic6_exe).old
EPIC_LINK = $(epic6_exe)
installepic6-std installirc-std: epic6 installdirs 
	$(INSTALL_PROGRAM) source/epic6 $(IP)$(DESTDIR)$(EPIC);	\
	$(RM) $(IP)$(DESTDIR)$(EPIC_LINK); \
	ln -s $(epic6)-$(VERSION) $(IP)$(DESTDIR)$(EPIC_LINK); 
uninstallepic6-std uninstallirc-std: 
	$(RM) $(IP)$(DESTDIR)$(EPIC)
	$(RM) $(IP)$(DESTDIR)$(EPIC_LINK)

installepic6-prod installirc-prod: epic6 installdirs 
	$(RM) $(IP)$(DESTDIR)$(EPIC_LINK); \
	$(INSTALL_PROGRAM) source/epic6 $(IP)$(DESTDIR)$(EPIC_LINK)
uninstallepic6-prod uninstallirc-prod: 
	$(RM) $(IP)$(DESTDIR)$(epic6_exe)

uninstalloldbins:
	$(RM) $(IP)$(DESTDIR)$(epic6_exe)-*


#
# wserv
#
wserv4:
	@+cd source; $(MAKE2) wserv4

WSERV	 = $(wserv_exe)
installwserv4: wserv4 installdirs 
	$(INSTALL_PROGRAM) source/wserv4 $(IP)$(DESTDIR)$(WSERV)
uninstallwserv4:
	$(RM) $(IP)$(DESTDIR)$(WSERV)

#
# Script library
#
scriptdir = $(epic6dir)/script
installscript: installdirs 
	for i in @srcdir@/script/*; \
	do \
		target=$(IP)$(DESTDIR)$(scriptdir)/`basename $$i`; \
		$(INSTALL_DATA) $$i $$target; \
	done
uninstallscript:
	$(RM) -r $(IP)$(DESTDIR)$(scriptdir)/*

installman: installdirs
	$(INSTALL_DATA) @srcdir@/doc/epic6.1 $(IP)$(DESTDIR)$(mandir)/man1/$(epic6).1
uninstallman: 
	$(RM) $(IP)$(DESTDIR)$(mandir)/man1/$(epic6).1

installdirs:
	umask 022; \
	for i in $(IP)$(DESTDIR)$(epic6dir) \
		 $(IP)$(DESTDIR)$(scriptdir) \
		 $(IP)$(DESTDIR)$(bindir) \
		 $(IP)$(DESTDIR)$(libexecdir) \
		 $(IP)$(DESTDIR)$(mandir)/man1 ; do \
	    if ! test -d $$i ; then mkdir -p $$i ; fi \
	done
uninstalldirs:
	for i in $(IP)$(DESTDIR)$(scriptdir) \
		 $(IP)$(DESTDIR)$(epic6dir) ; do \
	    if test -d $$i ; then rmdir $$i || true ; fi \
	done

clean:
	@-if test -f source/Makefile; then cd source; $(MAKE2) clean; fi

distclean cleandir realclean: clean
	$(RM) Makefile source/Makefile config.status config.cache config.log include/defs.h source/info.c.sh

depend:
	(cd source;make depend)

# This is the end of the file.
